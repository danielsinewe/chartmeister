{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/danielsinewe/chartmeister/chartmeister-schema.json",
  "name": "chartmeister-schema",
  "title": "Chartmeister File Format Schema",
  "description": "JSON schema for .chartmeister files - optimized for OpenAI structured outputs. Supports waterfall charts, grouped bars, and complete visual configurations.",
  "type": "object",
  "required": ["type", "version", "source", "elements", "appState", "files"],
  "properties": {
    "type": {
      "type": "string",
      "const": "chartmeister",
      "description": "The type identifier for chartmeister files"
    },
    "version": {
      "type": "integer",
      "minimum": 1,
      "description": "Schema version number"
    },
    "source": {
      "type": "string",
      "const": "chartmeister-app",
      "description": "Source application identifier"
    },
    "lastModified": {
      "type": "string",
      "description": "ISO 8601 timestamp of when the chart was last modified"
    },
    "elements": {
      "type": "array",
      "description": "Array of chart elements (bars, titles, legends, etc.)",
      "items": {
        "type": "object",
        "required": ["id", "type"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique identifier for the element",
            "pattern": "^[a-zA-Z0-9_-]+$"
          },
          "type": {
            "type": "string",
            "enum": ["bar", "connector", "annotation", "title", "subtitle", "legend"],
            "description": "Type of chart element"
          },
          "x": {
            "type": "number",
            "description": "X coordinate in pixels",
            "minimum": 0
          },
          "y": {
            "type": "number",
            "description": "Y coordinate in pixels",
            "minimum": 0
          },
          "width": {
            "type": "number",
            "description": "Width in pixels",
            "minimum": 0
          },
          "height": {
            "type": "number",
            "description": "Height in pixels",
            "minimum": 0
          },
          "strokeColor": {
            "type": "string",
            "pattern": "^#[0-9A-Fa-f]{6}$",
            "description": "Border color in hex format"
          },
          "backgroundColor": {
            "type": "string",
            "pattern": "^#[0-9A-Fa-f]{6}$",
            "description": "Background color in hex format"
          },
          "strokeWidth": {
            "type": "number",
            "minimum": 0,
            "description": "Border width in pixels"
          },
          "locked": {
            "type": "boolean",
            "description": "Whether the element is locked from editing"
          },
          "chartData": {
            "type": "object",
            "description": "Chart-specific data for bars",
            "properties": {
              "label": {
                "type": "string",
                "description": "Display label for the element"
              },
              "value": {
                "type": "number",
                "description": "Numeric value",
                "minimum": 0
              },
              "type": {
                "type": "string",
                "enum": ["total", "change", "start", "positive", "negative", "grouped"],
                "description": "Type of chart element"
              },
              "cumulative": {
                "type": "number",
                "description": "Cumulative value for waterfall charts",
                "minimum": 0
              },
              "editable": {
                "type": "boolean",
                "description": "Whether the value can be edited"
              },
              "showValueLabel": {
                "type": "boolean",
                "description": "Whether to show the value label"
              },
              "showCategoryLabel": {
                "type": "boolean",
                "description": "Whether to show the category label"
              },
              "color": {
                "type": "string",
                "pattern": "^#[0-9A-Fa-f]{6}$",
                "description": "Element color"
              },
              "segments": {
                "type": "array",
                "description": "Segments for grouped bars",
                "items": {
                  "type": "object",
                  "properties": {
                    "label": {
                      "type": "string",
                      "description": "Segment label"
                    },
                    "value": {
                      "type": "number",
                      "description": "Segment value"
                    },
                    "color": {
                      "type": "string",
                      "pattern": "^#[0-9A-Fa-f]{6}$",
                      "description": "Segment color"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "appState": {
      "type": "object",
      "description": "Application state and visual configuration",
      "properties": {
        "viewBackgroundColor": {
          "type": "string",
          "pattern": "^#[0-9A-Fa-f]{6}$",
          "description": "Background color of the view"
        },
        "theme": {
          "type": "string",
          "enum": ["light", "dark"],
          "description": "Application theme"
        },
        "chartVisual": {
          "type": "object",
          "description": "Chart visual configuration",
          "properties": {
            "title": {
              "type": "string",
              "description": "Chart title"
            },
            "subtitle": {
              "type": "string",
              "description": "Chart subtitle"
            },
            "showTitle": {
              "type": "boolean",
              "description": "Whether to show the title"
            },
            "showSubtitle": {
              "type": "boolean",
              "description": "Whether to show the subtitle"
            },
            "showLegend": {
              "type": "boolean",
              "description": "Whether to show the legend"
            },
            "showYAxis": {
              "type": "boolean",
              "description": "Whether to show the Y-axis"
            },
            "showXAxis": {
              "type": "boolean",
              "description": "Whether to show the X-axis"
            },
            "titleAlignment": {
              "type": "string",
              "enum": ["center", "justify", "start", "end"],
              "description": "Title alignment"
            },
            "legendLayout": {
              "type": "string",
              "enum": ["horizontal", "vertical"],
              "description": "Legend layout direction"
            },
            "valueLabels": {
              "type": "object",
              "description": "Value label configuration",
              "properties": {
                "visible": {
                  "type": "boolean",
                  "description": "Whether value labels are visible"
                },
                "position": {
                  "type": "string",
                  "enum": ["top", "bottom", "left", "right", "center"],
                  "description": "Value label position"
                },
                "color": {
                  "type": "string",
                  "pattern": "^#[0-9A-Fa-f]{6}$",
                  "description": "Value label color"
                },
                "fontSize": {
                  "type": "number",
                  "minimum": 1,
                  "description": "Value label font size"
                }
              }
            },
            "yAxis": {
              "type": "object",
              "description": "Y-axis configuration",
              "properties": {
                "visible": {
                  "type": "boolean",
                  "description": "Whether Y-axis is visible"
                },
                "minValue": {
                  "type": "number",
                  "description": "Y-axis minimum value"
                },
                "maxValue": {
                  "type": "number",
                  "description": "Y-axis maximum value"
                },
                "tickInterval": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Y-axis tick interval"
                },
                "title": {
                  "type": "string",
                  "description": "Y-axis title"
                }
              }
            },
            "layout": {
              "type": "object",
              "description": "Layout configuration",
              "properties": {
                "barWidth": {
                  "type": "number",
                  "minimum": 1,
                  "description": "Bar width in pixels"
                },
                "barSpacing": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Bar spacing in pixels"
                },
                "chartWidth": {
                  "type": "number",
                  "minimum": 100,
                  "description": "Chart width in pixels"
                },
                "chartHeight": {
                  "type": "number",
                  "minimum": 100,
                  "description": "Chart height in pixels"
                }
              }
            }
          }
        }
      }
    },
    "files": {
      "type": "object",
      "description": "Data for chart image elements",
      "additionalProperties": true
    }
  },
  "additionalProperties": false
}
