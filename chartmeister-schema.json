{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/danielsinewe/chartmeister/chartmeister-schema.json",
  "title": "Chartmeister File Format Schema",
  "description": "JSON schema for .chartmeister files - a format for saving and loading chart data, similar to Excalidraw's .excalidraw format. Version 3 includes fixes for anchorToBaseline property handling in total bars.",
  "type": "object",
  "required": ["type", "version", "source", "elements", "appState", "files"],
  "properties": {
    "type": {
      "type": "string",
      "const": "chartmeister",
      "description": "The type of the Chartmeister schema"
    },
    "version": {
      "type": "integer",
      "minimum": 1,
      "description": "The version of the Chartmeister schema. Version 3 includes fixes for anchorToBaseline property handling in total bars."
    },
    "source": {
      "type": "string",
      "const": "chartmeister-app",
      "description": "The source URL of the Chartmeister application"
    },
    "elements": {
      "type": "array",
      "description": "An array of objects representing chart elements on canvas",
      "items": {
        "type": "object",
        "required": ["id", "type"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique identifier for the element"
          },
          "type": {
            "type": "string",
            "enum": ["bar", "connector", "annotation", "title", "subtitle", "legend"],
            "description": "The type of chart element"
          },
          "x": {
            "type": "number",
            "description": "X coordinate of the element"
          },
          "y": {
            "type": "number",
            "description": "Y coordinate of the element"
          },
          "width": {
            "type": "number",
            "description": "Width of the element"
          },
          "height": {
            "type": "number",
            "description": "Height of the element"
          },
          "strokeColor": {
            "type": "string",
            "pattern": "^#[0-9A-Fa-f]{6}$",
            "description": "Stroke color in hex format"
          },
          "backgroundColor": {
            "type": "string",
            "pattern": "^#[0-9A-Fa-f]{6}$",
            "description": "Background color in hex format"
          },
          "strokeWidth": {
            "type": "number",
            "minimum": 0,
            "description": "Width of the stroke"
          },
          "locked": {
            "type": "boolean",
            "description": "Whether the element is locked from editing"
          },
          "customData": {
            "type": "object",
            "description": "Custom data associated with the element",
            "properties": {
              "originalData": {
                "type": "object",
                "description": "Original data from the chart"
              }
            }
          },
          "chartData": {
            "type": "object",
            "description": "Chart-specific data for the element",
            "properties": {
              "label": {
                "type": "string",
                "description": "Label for the chart element"
              },
              "value": {
                "type": "number",
                "description": "Value of the chart element"
              },
              "type": {
                "type": "string",
                "enum": ["total", "change", "start", "positive", "negative"],
                "description": "Type of chart element"
              },
              "cumulative": {
                "type": "number",
                "description": "Cumulative value"
              },
              "editable": {
                "type": "boolean",
                "description": "Whether the element is editable"
              },
              "showValueLabel": {
                "type": "boolean",
                "description": "Whether to show value label"
              },
              "showCategoryLabel": {
                "type": "boolean",
                "description": "Whether to show category label"
              },
              "color": {
                "type": "string",
                "pattern": "^#[0-9A-Fa-f]{6}$",
                "description": "Color of the element"
              },
              "borderColor": {
                "type": "string",
                "pattern": "^#[0-9A-Fa-f]{6}$",
                "description": "Border color of the element"
              },
              "borderWidth": {
                "type": "number",
                "minimum": 0,
                "description": "Border width of the element"
              },
              "segments": {
                "type": "array",
                "description": "Array of segments for segmented bars",
                "items": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string",
                      "description": "Unique identifier for the segment"
                    },
                    "label": {
                      "type": "string",
                      "description": "Label for the segment"
                    },
                    "value": {
                      "type": "number",
                      "description": "Value of the segment"
                    },
                    "color": {
                      "type": "string",
                      "pattern": "^#[0-9A-Fa-f]{6}$",
                      "description": "Color of the segment"
                    },
                    "borderColor": {
                      "type": "string",
                      "pattern": "^#[0-9A-Fa-f]{6}$",
                      "description": "Border color of the segment"
                    },
                    "borderWidth": {
                      "type": "number",
                      "minimum": 0,
                      "description": "Border width of the segment"
                    },
                    "locked": {
                      "type": "boolean",
                      "description": "Whether the segment is locked"
                    },
                    "showValueLabel": {
                      "type": "boolean",
                      "description": "Whether to show value label for the segment"
                    },
                    "valueLabelOffsetX": {
                      "type": "number",
                      "description": "X offset for value label"
                    },
              "valueLabelOffsetY": {
                "type": "number",
                "description": "Y offset for value label"
              }
            }
          },
          "computeTotal": {
            "type": "boolean",
            "description": "Whether the element should be automatically calculated from previous values"
          },
          "anchorToBaseline": {
            "type": "boolean",
            "description": "Whether the element is anchored to the baseline"
          }
                  }
                }
              }
            }
          }
        }
      }
    },
    "appState": {
      "type": "object",
      "description": "Additional application state/configuration",
      "properties": {
        "viewBackgroundColor": {
          "type": "string",
          "pattern": "^#[0-9A-Fa-f]{6}$",
          "description": "Background color of the view"
        },
        "currentItemStrokeColor": {
          "type": "string",
          "pattern": "^#[0-9A-Fa-f]{6}$",
          "description": "Current item stroke color"
        },
        "currentItemBackgroundColor": {
          "type": "string",
          "pattern": "^#[0-9A-Fa-f]{6}$",
          "description": "Current item background color"
        },
        "currentItemFillStyle": {
          "type": "string",
          "enum": ["hachure", "solid", "zigzag", "cross-hatch", "dots", "dashed", "zigzag-line"],
          "description": "Current item fill style"
        },
        "currentItemStrokeWidth": {
          "type": "number",
          "minimum": 0,
          "description": "Current item stroke width"
        },
        "currentItemStrokeStyle": {
          "type": "string",
          "enum": ["solid", "dashed", "dotted"],
          "description": "Current item stroke style"
        },
        "currentItemRoughness": {
          "type": "number",
          "minimum": 0,
          "maximum": 2,
          "description": "Current item roughness"
        },
        "currentItemOpacity": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Current item opacity"
        },
        "currentItemFontFamily": {
          "type": "integer",
          "description": "Current item font family"
        },
        "currentItemFontSize": {
          "type": "number",
          "minimum": 1,
          "description": "Current item font size"
        },
        "currentItemTextAlign": {
          "type": "string",
          "enum": ["left", "center", "right"],
          "description": "Current item text alignment"
        },
        "currentItemStartArrowhead": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "description": "Current item start arrowhead"
        },
        "currentItemEndArrowhead": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "description": "Current item end arrowhead"
        },
        "scrollX": {
          "type": "number",
          "description": "X scroll position"
        },
        "scrollY": {
          "type": "number",
          "description": "Y scroll position"
        },
        "zoom": {
          "type": "object",
          "properties": {
            "value": {
              "type": "number",
              "minimum": 0.1,
              "maximum": 5,
              "description": "Zoom level"
            }
          }
        },
        "gridSize": {
          "oneOf": [
            {
              "type": "number"
            },
            {
              "type": "null"
            }
          ],
          "description": "Grid size"
        },
        "viewModeEnabled": {
          "type": "boolean",
          "description": "Whether view mode is enabled"
        },
        "theme": {
          "type": "string",
          "enum": ["light", "dark"],
          "description": "Theme of the application"
        },
        "selectedElementIds": {
          "type": "object",
          "additionalProperties": {
            "type": "boolean"
          },
          "description": "Selected element IDs"
        },
        "selectedGroupIds": {
          "type": "object",
          "additionalProperties": {
            "type": "boolean"
          },
          "description": "Selected group IDs"
        },
        "editingGroupId": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "description": "Currently editing group ID"
        },
        "editingLinearElement": {
          "oneOf": [
            {
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "description": "Currently editing linear element"
        },
        "selectedElements": {
          "type": "object",
          "properties": {
            "elements": {
              "type": "array",
              "description": "Selected elements"
            },
            "appState": {
              "type": "object",
              "description": "App state for selected elements"
            }
          }
        },
        "chartState": {
          "type": "object",
          "description": "Chart-specific state",
          "properties": {
            "selectedBar": {
              "oneOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Selected bar ID"
            },
            "selectedConnector": {
              "oneOf": [
                {
                  "type": "number"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Selected connector index"
            },
            "selectedSegment": {
              "oneOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Selected segment ID"
            },
            "selectedPercentAnnotation": {
              "oneOf": [
                {
                  "type": "number"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Selected percent annotation index"
            },
            "hoveredElement": {
              "oneOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Hovered element ID"
            },
            "editingLabel": {
              "oneOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Currently editing label"
            },
            "editingValue": {
              "oneOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Currently editing value"
            },
            "editingSegmentValue": {
              "oneOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Currently editing segment value"
            },
            "isDragging": {
              "oneOf": [
                {
                  "type": "boolean"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Whether currently dragging"
            },
            "draggingSegment": {
              "oneOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Currently dragging segment ID"
            },
            "showLockIcon": {
              "oneOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Show lock icon for element"
            },
            "percentAnnotations": {
              "type": "array",
              "description": "Percent annotations"
            },
            "guides": {
              "type": "array",
              "description": "Guide lines"
            },
            "selectedGuideId": {
              "oneOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Selected guide ID"
            },
            "contextMenu": {
              "oneOf": [
                {
                  "type": "object",
                  "properties": {
                    "visible": {
                      "type": "boolean"
                    },
                    "x": {
                      "type": "number"
                    },
                    "y": {
                      "type": "number"
                    }
                  }
                },
                {
                  "type": "null"
                }
              ],
              "description": "Context menu state"
            }
          }
        },
        "chartVisual": {
          "type": "object",
          "description": "Chart visual configuration",
          "properties": {
            "title": {
              "type": "string",
              "description": "Chart title"
            },
            "subtitle": {
              "type": "string",
              "description": "Chart subtitle"
            },
            "showTitle": {
              "type": "boolean",
              "description": "Whether to show title"
            },
            "showSubtitle": {
              "type": "boolean",
              "description": "Whether to show subtitle"
            },
            "titleSize": {
              "type": "object",
              "properties": {
                "width": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Title width"
                },
                "height": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Title height"
                }
              },
              "description": "Title size configuration"
            },
            "subtitleSize": {
              "type": "object",
              "properties": {
                "width": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Subtitle width"
                },
                "height": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Subtitle height"
                }
              },
              "description": "Subtitle size configuration"
            },
            "showLegend": {
              "type": "boolean",
              "description": "Whether to show legend"
            },
            "showYAxis": {
              "type": "boolean",
              "description": "Whether to show Y-axis"
            },
            "showYAxisName": {
              "type": "boolean",
              "description": "Whether to show Y-axis name"
            },
            "showYAxisLine": {
              "type": "boolean",
              "description": "Whether to show Y-axis line"
            },
            "showYAxisTicks": {
              "type": "boolean",
              "description": "Whether to show Y-axis ticks"
            },
            "showYAxisLabels": {
              "type": "boolean",
              "description": "Whether to show Y-axis labels"
            },
            "showXAxis": {
              "type": "boolean",
              "description": "Whether to show X-axis"
            },
            "showXAxisName": {
              "type": "boolean",
              "description": "Whether to show X-axis name"
            },
            "showXAxisLine": {
              "type": "boolean",
              "description": "Whether to show X-axis line"
            },
            "showXAxisTicks": {
              "type": "boolean",
              "description": "Whether to show X-axis ticks"
            },
            "showXAxisLabels": {
              "type": "boolean",
              "description": "Whether to show X-axis labels"
            },
            "showBackgroundGrid": {
              "type": "boolean",
              "description": "Whether to show background grid"
            },
            "hiddenLegendColors": {
              "type": "array",
              "items": {
                "type": "string",
                "pattern": "^#[0-9A-Fa-f]{6}$"
              },
              "description": "Hidden legend colors"
            },
            "legendEntries": {
              "type": "array",
              "description": "Legend entries",
              "items": {
                "type": "object",
                "properties": {
                  "color": {
                    "type": "string",
                    "pattern": "^#[0-9A-Fa-f]{6}$",
                    "description": "Legend entry color"
                  },
                  "label": {
                    "type": "string",
                    "description": "Legend entry label"
                  },
                  "shape": {
                    "type": "string",
                    "enum": ["square", "circle", "diamond", "triangle"],
                    "description": "Legend entry shape"
                  }
                }
              }
            },
            "legendIconShapes": {
              "type": "object",
              "additionalProperties": {
                "type": "string",
                "enum": ["square", "circle", "diamond", "triangle"]
              },
              "description": "Legend icon shapes mapping"
            },
            "titleAlignment": {
              "type": "string",
              "enum": ["center", "justify", "start", "end"],
              "description": "Title alignment"
            },
            "subtitleAlignment": {
              "type": "string",
              "enum": ["center", "justify", "start", "end"],
              "description": "Subtitle alignment"
            },
            "legendAlignment": {
              "type": "string",
              "enum": ["center", "justify", "start", "end"],
              "description": "Legend alignment"
            },
            "legendLayout": {
              "type": "string",
              "enum": ["horizontal", "vertical"],
              "description": "Legend layout direction"
            },
            "legendMaxWidth": {
              "type": "number",
              "minimum": 0,
              "description": "Maximum width of the legend before wrapping to next row"
            },
            "legendPosition": {
              "type": "object",
              "properties": {
                "x": {
                  "type": "number",
                  "description": "Legend X position"
                },
                "y": {
                  "type": "number",
                  "description": "Legend Y position"
                }
              },
              "description": "Legend position"
            },
            "legendSize": {
              "type": "object",
              "properties": {
                "width": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Legend width"
                },
                "height": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Legend height"
                }
              },
              "description": "Legend size"
            },
            "xAxisLabelRotation": {
              "type": "number",
              "minimum": -90,
              "maximum": 90,
              "description": "X-axis label rotation angle"
            },
            "autoRotationEnabled": {
              "type": "boolean",
              "description": "Whether auto-rotation is enabled"
            },
            "dynamicPositioningEnabled": {
              "type": "boolean",
              "description": "Whether dynamic positioning is enabled"
            },
            "titleVerticalPosition": {
              "type": "number",
              "description": "Title vertical position"
            },
            "subtitleVerticalPosition": {
              "type": "number",
              "description": "Subtitle vertical position"
            },
            "legendVerticalPosition": {
              "type": "number",
              "description": "Legend vertical position"
            },
            "chartBorder": {
              "type": "object",
              "properties": {
                "color": {
                  "type": "string",
                  "pattern": "^#[0-9A-Fa-f]{6}$",
                  "description": "Chart border color"
                },
                "width": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Chart border width"
                },
                "type": {
                  "type": "string",
                  "enum": ["solid", "dashed", "dotted"],
                  "description": "Chart border type"
                }
              },
              "description": "Chart border configuration"
            },
            "cornerRadius": {
              "type": "number",
              "minimum": 0,
              "description": "Corner radius"
            },
            "topCornerRadius": {
              "type": "number",
              "minimum": 0,
              "description": "Top corner radius"
            },
            "bottomCornerRadius": {
              "type": "number",
              "minimum": 0,
              "description": "Bottom corner radius"
            },
            "separateCornerRadius": {
              "type": "boolean",
              "description": "Whether to use separate corner radius"
            },
            "connectors": {
              "type": "object",
              "properties": {
                "visible": {
                  "type": "boolean",
                  "description": "Whether connectors are visible"
                },
                "strokeWidth": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Connector stroke width"
                },
                "strokeDasharray": {
                  "type": "string",
                  "description": "Connector stroke dash array"
                },
                "color": {
                  "type": "string",
                  "pattern": "^#[0-9A-Fa-f]{6}$",
                  "description": "Connector color"
                }
              },
              "description": "Connector configuration"
            },
            "percentAnnotations": {
              "type": "object",
              "properties": {
                "visible": {
                  "type": "boolean",
                  "description": "Whether percent annotations are visible"
                },
                "color": {
                  "type": "string",
                  "pattern": "^#[0-9A-Fa-f]{6}$",
                  "description": "Percent annotation color"
                },
                "fontSize": {
                  "type": "number",
                  "minimum": 1,
                  "description": "Percent annotation font size"
                },
                "fontWeight": {
                  "type": "number",
                  "minimum": 100,
                  "maximum": 900,
                  "description": "Percent annotation font weight"
                }
              },
              "description": "Percent annotation configuration"
            },
            "valueLabels": {
              "type": "object",
              "properties": {
                "visible": {
                  "type": "boolean",
                  "description": "Whether value labels are visible"
                },
                "position": {
                  "type": "string",
                  "enum": ["top", "bottom", "left", "right", "center"],
                  "description": "Value label position"
                },
                "color": {
                  "type": "string",
                  "pattern": "^#[0-9A-Fa-f]{6}$",
                  "description": "Value label color"
                },
                "fontSize": {
                  "type": "number",
                  "minimum": 1,
                  "description": "Value label font size"
                },
                "fontWeight": {
                  "type": "number",
                  "minimum": 100,
                  "maximum": 900,
                  "description": "Value label font weight"
                },
                "offset": {
                  "type": "number",
                  "description": "Value label offset"
                },
                "format": {
                  "type": "string",
                  "enum": ["%", "$", "€", "£", "¥", "number"],
                  "description": "Value label format"
                }
              },
              "description": "Value label configuration"
            },
            "categoryLabels": {
              "type": "object",
              "properties": {
                "visible": {
                  "type": "boolean",
                  "description": "Whether category labels are visible"
                },
                "position": {
                  "type": "string",
                  "enum": ["top", "bottom", "left", "right", "center"],
                  "description": "Category label position"
                },
                "color": {
                  "type": "string",
                  "pattern": "^#[0-9A-Fa-f]{6}$",
                  "description": "Category label color"
                },
                "fontSize": {
                  "type": "number",
                  "minimum": 1,
                  "description": "Category label font size"
                },
                "fontWeight": {
                  "type": "number",
                  "minimum": 100,
                  "maximum": 900,
                  "description": "Category label font weight"
                },
                "offset": {
                  "type": "number",
                  "description": "Category label offset"
                }
              },
              "description": "Category label configuration"
            },
            "yAxis": {
              "type": "object",
              "properties": {
                "visible": {
                  "type": "boolean",
                  "description": "Whether Y-axis is visible"
                },
                "minValue": {
                  "type": "number",
                  "description": "Y-axis minimum value"
                },
                "maxValue": {
                  "type": "number",
                  "description": "Y-axis maximum value"
                },
                "tickInterval": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Y-axis tick interval"
                },
                "color": {
                  "type": "string",
                  "pattern": "^#[0-9A-Fa-f]{6}$",
                  "description": "Y-axis color"
                },
                "fontSize": {
                  "type": "number",
                  "minimum": 1,
                  "description": "Y-axis font size"
                },
                "fontWeight": {
                  "type": "number",
                  "minimum": 100,
                  "maximum": 900,
                  "description": "Y-axis font weight"
                },
                "tickLength": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Y-axis tick length"
                },
                "gridLines": {
                  "type": "boolean",
                  "description": "Whether to show grid lines"
                },
                "title": {
                  "type": "string",
                  "description": "Y-axis title"
                }
              },
              "description": "Y-axis configuration"
            },
            "xAxis": {
              "type": "object",
              "properties": {
                "labelRotation": {
                  "type": "number",
                  "minimum": -90,
                  "maximum": 90,
                  "description": "X-axis label rotation"
                }
              },
              "description": "X-axis configuration"
            },
            "layout": {
              "type": "object",
              "properties": {
                "barWidth": {
                  "type": "number",
                  "minimum": 1,
                  "description": "Bar width"
                },
                "barSpacing": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Bar spacing"
                },
                "chartWidth": {
                  "type": "number",
                  "minimum": 100,
                  "description": "Chart width"
                },
                "chartHeight": {
                  "type": "number",
                  "minimum": 100,
                  "description": "Chart height"
                },
                "marginTop": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Top margin"
                },
                "marginBottom": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Bottom margin"
                },
                "marginLeft": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Left margin"
                },
                "marginRight": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Right margin"
                }
              },
              "description": "Layout configuration"
            }
          }
        }
      }
    },
    "files": {
      "type": "object",
      "description": "Data for chart image elements",
      "additionalProperties": true
    }
  },
  "additionalProperties": false
}
